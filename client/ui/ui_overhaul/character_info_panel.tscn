[gd_scene load_steps=23 format=3 uid="uid://d0khn1uw56sxd"]

[ext_resource type="ButtonGroup" uid="uid://dcoayub2mcste" path="res://scenes/ui/CharacterSelectionBtnGroup.tres" id="1_dx5ol"]
[ext_resource type="PackedScene" uid="uid://x3b3wxhlpsi2" path="res://scenes/ui/CharacterListElement.tscn" id="1_qnof2"]
[ext_resource type="PackedScene" uid="uid://cgco77hqkmtwl" path="res://entities/mercenaries/Barbarian_new.tscn" id="1_r83m7"]
[ext_resource type="Texture2D" uid="uid://qhiy6ljrxf82" path="res://textures/icons/mercenaries/barbarian.png" id="2_rqdck"]
[ext_resource type="Texture2D" uid="uid://cwrg0gbaq852l" path="res://textures/icons/mercenaries/orc.png" id="3_261bc"]

[sub_resource type="GDScript" id="GDScript_hgcf2"]
script/source = "extends VBoxContainer

@export var where_to_put_mercenary: Node3D
var current_mercenary_model: Mercenary

func _change_mercenary_render(mercenary: Mercenary):
	current_mercenary_model.queue_free()
	where_to_put_mercenary.add_child(mercenary)
	current_mercenary_model = mercenary
	
func _reintitialize_tooltips(mercenary: Mercenary):
	mercenary.ability_caster_component.basic_attack
	mercenary.ability_caster_component.passive_ability
	mercenary.ability_caster_component.first_ability
	mercenary.ability_caster_component.second_ability
	mercenary.ability_caster_component.third_ability
	mercenary.ability_caster_component.ultimate_ability

func change_preview(mercenary: Mercenary) -> void:
	_change_mercenary_render(mercenary)
	_reintitialize_tooltips(mercenary)
	
func change_preview_to_named(mercenary_name: StringName):
	#change_preview(MercenaryRegistry.get_singleton())
	pass

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	pass # Replace with function body.


# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta: float) -> void:
	pass
"

[sub_resource type="ViewportTexture" id="ViewportTexture_ejegn"]
viewport_path = NodePath("PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport")

[sub_resource type="GDScript" id="GDScript_ibdfi"]
script/source = "extends TextureRect

@export var viewport: SubViewport

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	(texture as ViewportTexture).viewport_path = viewport.get_path()

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta: float) -> void:
	pass
"

[sub_resource type="GDScript" id="GDScript_3tod5"]
script/source = "extends SubViewport

@export var rotation_deg_per_second: float = 6

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	pass # Replace with function body.

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta: float) -> void:
	# Rotate character
	$\"Mercenary\".rotate_y(deg_to_rad(rotation_deg_per_second*delta))
"

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_fvj0c"]
albedo_color = Color(0.37, 0.2405, 0.0592, 1)

[sub_resource type="CylinderMesh" id="CylinderMesh_byhk6"]
material = SubResource("StandardMaterial3D_fvj0c")
top_radius = 1.0
bottom_radius = 1.2
height = 0.2

[sub_resource type="CappedResourceAttribute" id="CappedResourceAttribute_s11qg"]
resource_local_to_scene = true

[sub_resource type="FloatAttribute" id="FloatAttribute_gdwnw"]
resource_local_to_scene = true
base = 30.0

[sub_resource type="FloatAttribute" id="FloatAttribute_ckxpr"]
resource_local_to_scene = true
base = 75.0

[sub_resource type="FloatAttribute" id="FloatAttribute_4s824"]
resource_local_to_scene = true

[sub_resource type="FloatAttribute" id="FloatAttribute_gi824"]
resource_local_to_scene = true

[sub_resource type="FloatAttribute" id="FloatAttribute_axunt"]
resource_local_to_scene = true
base = 1800.0

[sub_resource type="ViewportTexture" id="ViewportTexture_ia30n"]
viewport_path = NodePath("EntityHealthBar/SubViewport")

[sub_resource type="CylinderMesh" id="CylinderMesh_gek44"]
material = SubResource("StandardMaterial3D_fvj0c")
top_radius = 1.2
bottom_radius = 1.2

[sub_resource type="PlaceholderTexture2D" id="PlaceholderTexture2D_uuyfi"]
size = Vector2(48, 48)

[sub_resource type="PlaceholderTexture2D" id="PlaceholderTexture2D_7dlhw"]
size = Vector2(64, 64)

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_ebsd8"]
width = 48
height = 48

[node name="CharacterSelection" type="UserInterface" node_paths=PackedStringArray("main_menu")]
offset_right = 1920.0
offset_bottom = 1080.0
size_flags_horizontal = 3
size_flags_stretch_ratio = 3.0
main_menu = NodePath("PanelContainer")

[node name="PanelContainer" type="MainMenu" parent="." node_paths=PackedStringArray("ip_input", "nickname_input", "join_button", "character_select_area")]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
ip_input = NodePath("HSplitContainer/CharacterArea/VBoxContainer/IpInput")
nickname_input = NodePath("HSplitContainer/CharacterArea/VBoxContainer/NicknameInput")
join_button = NodePath("HSplitContainer/CharacterArea/VBoxContainer/JoinBtn")
character_button_group = ExtResource("1_dx5ol")
character_select_area = NodePath("HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/ScrollContainer/GridContainer")

[node name="HSplitContainer" type="HSplitContainer" parent="PanelContainer"]
layout_mode = 2
collapsed = true
dragger_visibility = 2

[node name="CharacterArea" type="VBoxContainer" parent="PanelContainer/HSplitContainer"]
custom_minimum_size = Vector2(1280, 0)
layout_mode = 2
metadata/_edit_use_anchors_ = true

[node name="Header" type="Label" parent="PanelContainer/HSplitContainer/CharacterArea"]
custom_minimum_size = Vector2(0, 96)
layout_mode = 2
theme_override_font_sizes/font_size = 66
text = "Pick your character!"
horizontal_alignment = 1
vertical_alignment = 1

[node name="MarginContainer2" type="MarginContainer" parent="PanelContainer/HSplitContainer/CharacterArea"]
layout_mode = 2
theme_override_constants/margin_left = 24
theme_override_constants/margin_top = 24
theme_override_constants/margin_right = 24
theme_override_constants/margin_bottom = 24

[node name="MarginContainer" type="HSplitContainer" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2"]
layout_mode = 2

[node name="ScrollContainer" type="ScrollContainer" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer"]
custom_minimum_size = Vector2(0, 800)
layout_mode = 2
size_flags_horizontal = 3
horizontal_scroll_mode = 0

[node name="GridContainer" type="GridContainer" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/ScrollContainer"]
layout_mode = 2
size_flags_vertical = 4
theme_override_constants/h_separation = 16
theme_override_constants/v_separation = 16
columns = 8

[node name="Barbarian" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/ScrollContainer/GridContainer" instance=ExtResource("1_qnof2")]
layout_mode = 2
character_index = "Barbarian_new"
title = "Barbarian"
icon = ExtResource("2_rqdck")

[node name="Orc" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/ScrollContainer/GridContainer" instance=ExtResource("1_qnof2")]
layout_mode = 2
character_index = "Orc_new"
title = "Orc"
icon = ExtResource("3_261bc")

[node name="MarginContainer" type="MarginContainer" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer"]
layout_mode = 2
size_flags_horizontal = 3
size_flags_stretch_ratio = 0.4
theme_override_constants/margin_left = 12
theme_override_constants/margin_top = 12
theme_override_constants/margin_right = 12
theme_override_constants/margin_bottom = 12

[node name="AbilitySetPreview" type="VBoxContainer" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer"]
layout_mode = 2
size_flags_horizontal = 3
script = SubResource("GDScript_hgcf2")

[node name="CharacterModelPreview" type="AspectRatioContainer" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview"]
layout_mode = 2
size_flags_vertical = 3

[node name="TextureRect" type="TextureRect" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview" node_paths=PackedStringArray("viewport")]
layout_mode = 2
texture = SubResource("ViewportTexture_ejegn")
expand_mode = 4
script = SubResource("GDScript_ibdfi")
viewport = NodePath("../SubViewport")

[node name="SubViewport" type="SubViewport" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview"]
own_world_3d = true
transparent_bg = true
size = Vector2i(768, 512)
script = SubResource("GDScript_3tod5")
rotation_deg_per_second = 12.0

[node name="Camera3D" type="Camera3D" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport"]
transform = Transform3D(1, 0, 0, 0, 0.958417, 0.285371, 0, -0.285371, 0.958417, 0, 1.14789, 1.90204)
v_offset = -0.235
current = true
fov = 28.125

[node name="MeshInstance3D2" type="MeshInstance3D" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.1, 0)
visible = false
mesh = SubResource("CylinderMesh_byhk6")

[node name="Mercenary" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport" instance=ExtResource("1_r83m7")]

[node name="EntityAttributesComponent" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport/Mercenary" index="1"]
health = SubResource("CappedResourceAttribute_s11qg")
global_defense = SubResource("FloatAttribute_gdwnw")
attack_damage = SubResource("FloatAttribute_ckxpr")
magic_power = SubResource("FloatAttribute_4s824")
cooldown_reduction = SubResource("FloatAttribute_gi824")
movement_speed = SubResource("FloatAttribute_axunt")

[node name="BarbarianBleedingPassive" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport/Mercenary/AbilityCasterComponent" index="2"]
max_cooldown = nan

[node name="Sprite3D" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport/Mercenary/EntityInfoRenderer/EntityHealthBar" index="0"]
texture = SubResource("ViewportTexture_ia30n")

[node name="BoneAttachment3D" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport/Mercenary/VisualComponent3D/barbarian/Armature/Skeleton3D" index="1"]
transform = Transform3D(-0.997886, -0.027534, -0.0588776, 0.0276974, -0.999615, -0.00196509, -0.0588008, -0.00359172, 0.998263, -0.990648, 0.725769, -0.061733)

[node name="MeshInstance3D" type="MeshInstance3D" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1.2, 0)
visible = false
mesh = SubResource("CylinderMesh_gek44")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0)

[node name="HoverableIcons" type="VSplitContainer" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview"]
layout_mode = 2
size_flags_vertical = 8

[node name="GridContainer" type="HBoxContainer" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/HoverableIcons"]
layout_mode = 2
alignment = 1

[node name="ActiveAbilityIcon5" type="TextureRect" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/HoverableIcons/GridContainer"]
layout_mode = 2
size_flags_horizontal = 4
size_flags_vertical = 4
texture = SubResource("PlaceholderTexture2D_uuyfi")

[node name="ActiveAbilityIcon6" type="TextureRect" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/HoverableIcons/GridContainer"]
layout_mode = 2
size_flags_horizontal = 4
size_flags_vertical = 4
texture = SubResource("PlaceholderTexture2D_uuyfi")

[node name="ActiveAbilityIcon" type="TextureRect" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/HoverableIcons/GridContainer"]
layout_mode = 2
texture = SubResource("PlaceholderTexture2D_7dlhw")

[node name="ActiveAbilityIcon2" type="TextureRect" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/HoverableIcons/GridContainer"]
layout_mode = 2
texture = SubResource("PlaceholderTexture2D_7dlhw")

[node name="ActiveAbilityIcon3" type="TextureRect" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/HoverableIcons/GridContainer"]
layout_mode = 2
texture = SubResource("PlaceholderTexture2D_7dlhw")

[node name="ActiveAbilityIcon4" type="TextureRect" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/HoverableIcons/GridContainer"]
layout_mode = 2
texture = SubResource("PlaceholderTexture2D_7dlhw")

[node name="AbilityTooltip1" type="AbilityTooltip" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview" node_paths=PackedStringArray("ability_icon_display", "ability_name_display", "ability_description_display")]
custom_minimum_size = Vector2(512, 0)
layout_mode = 2
size_flags_horizontal = 4
size_flags_vertical = 8
mouse_filter = 2
ability_icon_display = NodePath("MarginContainer/VBoxContainer/FlowContainer/TextureRect")
ability_name_display = NodePath("MarginContainer/VBoxContainer/FlowContainer/AbilityName")
ability_description_display = NodePath("MarginContainer/VBoxContainer/AbilityText")

[node name="MarginContainer" type="MarginContainer" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/AbilityTooltip1"]
layout_mode = 2
theme_override_constants/margin_left = 12
theme_override_constants/margin_top = 12
theme_override_constants/margin_right = 12
theme_override_constants/margin_bottom = 12

[node name="VBoxContainer" type="VBoxContainer" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/AbilityTooltip1/MarginContainer"]
layout_mode = 2

[node name="FlowContainer" type="HSplitContainer" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/AbilityTooltip1/MarginContainer/VBoxContainer"]
layout_mode = 2
dragger_visibility = 1

[node name="TextureRect" type="TextureRect" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/AbilityTooltip1/MarginContainer/VBoxContainer/FlowContainer"]
custom_minimum_size = Vector2(48, 48)
layout_mode = 2
texture = SubResource("NoiseTexture2D_ebsd8")
expand_mode = 3

[node name="AbilityName" type="Label" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/AbilityTooltip1/MarginContainer/VBoxContainer/FlowContainer"]
layout_mode = 2
text = "Ability name here"

[node name="AbilityText" type="Label" parent="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/AbilityTooltip1/MarginContainer/VBoxContainer"]
layout_mode = 2
text = "Basic attacks apply bleeding to hit target dealing {x} damage, every 0.5s for 4s.

Total damage: {x*8}"
autowrap_mode = 2

[node name="VBoxContainer" type="VBoxContainer" parent="PanelContainer/HSplitContainer/CharacterArea"]
custom_minimum_size = Vector2(256, 0)
layout_mode = 2
size_flags_horizontal = 4

[node name="NicknameInput" type="LineEdit" parent="PanelContainer/HSplitContainer/CharacterArea/VBoxContainer"]
layout_mode = 2
placeholder_text = "Nickname..."

[node name="IpInput" type="LineEdit" parent="PanelContainer/HSplitContainer/CharacterArea/VBoxContainer"]
layout_mode = 2
text = "localhost"
placeholder_text = "Server address..."

[node name="JoinBtn" type="Button" parent="PanelContainer/HSplitContainer/CharacterArea/VBoxContainer"]
layout_mode = 2
text = "Join game"

[connection signal="pressed" from="PanelContainer/HSplitContainer/CharacterArea/VBoxContainer/JoinBtn" to="PanelContainer/HSplitContainer/CharacterArea/VBoxContainer/JoinBtn" method="_on_pressed"]

[editable path="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/ScrollContainer/GridContainer/Barbarian"]
[editable path="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport/Mercenary"]
[editable path="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport/Mercenary/EntityInfoRenderer"]
[editable path="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport/Mercenary/VisualComponent3D/barbarian"]
[editable path="PanelContainer/HSplitContainer/CharacterArea/MarginContainer2/MarginContainer/MarginContainer/AbilitySetPreview/CharacterModelPreview/SubViewport/Mercenary/BasicAttack01VFX"]
